\documentclass[a4paper,10pt]{article}
\usepackage[left=15mm,right=15mm,top=35mm,bottom=15mm,headheight=22mm]{geometry}
\usepackage{amsmath,amssymb}
\usepackage{booktabs}
\usepackage{fancyhdr}
\usepackage{xcolor}
\usepackage{multicol}
\usepackage{graphicx}
\usepackage{titlesec}
\usepackage{parskip}

% ── Colours ──────────────────────────────────────────────────
\definecolor{passgreen}{HTML}{2E7D32}
\definecolor{failred}{HTML}{C62828}
\definecolor{headblue}{HTML}{1565C0}
\definecolor{ruleblue}{HTML}{90CAF9}

\newcommand{\pass}{\textcolor{passgreen}{\textbf{PASS}}}
\newcommand{\fail}{\textcolor{failred}{\textbf{FAIL}}}

% ── Section formatting ───────────────────────────────────────
\titleformat{\section}
  {\small\bfseries\color{headblue}}{}{0em}{}
  [\vspace{-0.4em}{\color{ruleblue}\rule{\columnwidth}{0.3pt}}]
\titlespacing*{\section}{0pt}{6pt}{2pt}

% ── Page header ──────────────────────────────────────────────
\pagestyle{fancy}
\fancyhf{}
\lhead{%
  \BLOCK{if has_logo}%
  \includegraphics[height=14mm]{\VAR{logo_filename}}%
  \BLOCK{else}%
  \raisebox{2mm}{\textbf{\large\color{headblue}formandfunction}}%
  \BLOCK{endif}%
}
\rhead{%
  \scriptsize%
  \begin{tabular}[b]{@{}r@{\,}l@{\quad}r@{\,}l@{}}
    \textbf{Project:} & \VAR{project_title} & \textbf{Calcs by:} & \VAR{calcs_by} \\
    \textbf{Job No:} & \VAR{job_no} & \textbf{Checked:} & \VAR{checked_by} \\
    \textbf{Calcs for:} & \VAR{calcs_for} & \textbf{Approved:} & \VAR{approved_by} \\
  \end{tabular}%
}
\renewcommand{\headrulewidth}{0.5pt}
\cfoot{\scriptsize Page~\thepage}

% ── Layout ───────────────────────────────────────────────────
\setlength{\columnsep}{4mm}
\setlength{\parindent}{0pt}
\setlength{\parskip}{1.5pt}

\begin{document}

% ══════════════════════════════════════════════════════════════
%  Title
% ══════════════════════════════════════════════════════════════
\begin{center}
  {\normalsize\bfseries\color{headblue} Steel Truss Member Design to Eurocode 3}\\[1pt]
  {\footnotesize EN 1993-1-1:2005}\\[3pt]
  {\small\bfseries \VAR{designation} \;---\; \VAR{steel_grade}}\\[1pt]
  {\small $N_{Ed,comp} = \VAR{NEd_comp}$\,kN \qquad $N_{Ed,tens} = \VAR{NEd_tens}$\,kN}
\end{center}
\vspace{-1mm}
{\color{headblue}\hrule height 0.5pt}
\vspace{3mm}

% ══════════════════════════════════════════════════════════════
%  Section Properties (full width)
% ══════════════════════════════════════════════════════════════
{\small\bfseries\color{headblue} Section Properties (\VAR{section_type})}
\vspace{-1mm}

{\color{ruleblue}\rule{\textwidth}{0.3pt}}
\vspace{1mm}

\begin{center}
\footnotesize
\begin{tabular}{@{}ll@{\quad}ll@{\quad}ll@{\quad}ll@{}}
\toprule
$h$        & \VAR{h}\,mm      & $b$        & \VAR{b}\,mm      & $t$        & \VAR{t}\,mm      & $A$        & \VAR{A_sec}\,cm$^2$ \\
$I_y$      & \VAR{Iy}\,cm$^4$ & $I_z$      & \VAR{Iz_sec}\,cm$^4$ & $i_y$  & \VAR{iy}\,mm     & $i_z$      & \VAR{iz}\,mm \\
$W_{el,y}$ & \VAR{Wel_y}\,cm$^3$ & $W_{pl,y}$ & \VAR{Wpl_y}\,cm$^3$ & $W_{el,z}$ & \VAR{Wel_z}\,cm$^3$ & $W_{pl,z}$ & \VAR{Wpl_z}\,cm$^3$ \\
\midrule
\multicolumn{4}{@{}l}{Mass: \VAR{mass}\,kg/m} & \multicolumn{4}{l}{$L_{cr,ip} = \VAR{Lcr_ip}$\,m \quad $L_{cr,oop} = \VAR{Lcr_oop}$\,m} \\
\bottomrule
\end{tabular}
\end{center}
\vspace{2mm}

% ══════════════════════════════════════════════════════════════
%  2-Column Design Checks (Steps 1–3 left, Step 4 right)
% ══════════════════════════════════════════════════════════════
\begin{multicols}{2}
\small

% ── Step 1 ──────────────────────────────────────────────────
\section{Step 1: Yield Strength}
{\footnotesize\itshape Table 3.1}

\VAR{steel_grade},\; $t = \VAR{t}$\,mm

$f_y = \VAR{fy}$\,N/mm$^2$

$\varepsilon = \sqrt{235/\VAR{fy}} = \VAR{epsilon}$

% ── Step 2 ──────────────────────────────────────────────────
\section{Step 2: Classification}
{\footnotesize\itshape Table 5.2 --- Internal compression parts}

$c = h - 2t = \VAR{c_h}$\,mm

$c/t = \VAR{ct_gov}$

\medskip
Limits: $33\varepsilon = \VAR{limit_33e}$,\;
$38\varepsilon = \VAR{limit_38e}$,\;
$42\varepsilon = \VAR{limit_42e}$

\medskip
\fbox{\textbf{Class \VAR{section_class}}}

% ── Step 3 ──────────────────────────────────────────────────
\section{Step 3: Cross-section Resistance}
{\footnotesize\itshape \S\,6.2.4}

$N_{Rd} = A \cdot f_y / \gamma_{M0}$

$= \VAR{A_sec}{\times}10^2{\times}\VAR{fy} / 10^3$

$= \VAR{NRd}$\,kN

\columnbreak

% ── Step 4 ──────────────────────────────────────────────────
\section{Step 4: Flexural Buckling}
{\footnotesize\itshape \S\,6.3.1}

$\lambda_1 = 93.9\varepsilon = \VAR{lambda_1}$

\medskip
\textbf{In-plane:}

$\bar{\lambda}_{ip} = L_{cr,ip}{\times}10^3 / (i \cdot \lambda_1)$

$= \VAR{lambda_bar_ip}$

\medskip
\textbf{Out-of-plane:}

$\bar{\lambda}_{oop} = L_{cr,oop}{\times}10^3 / (i \cdot \lambda_1)$

$= \VAR{lambda_bar_oop}$

\medskip
Governing $\bar{\lambda} = \VAR{lambda_bar}$

\medskip
Curve \textbf{\VAR{buckling_curve}},\;
$\alpha = \VAR{alpha_imp}$

$\Phi = 0.5[1+\alpha(\bar{\lambda}-0.2)+\bar{\lambda}^2]$

$= \VAR{Phi}$

$\chi = 1/(\Phi+\sqrt{\Phi^2-\bar{\lambda}^2})$

$= \VAR{chi}$

\medskip
$N_{b,Rd} = \chi \cdot A \cdot f_y / \gamma_{M1}$

$= \VAR{Nb_Rd}$\,kN

\end{multicols}

\vspace{2mm}

% ══════════════════════════════════════════════════════════════
%  Compression Check (full width)
% ══════════════════════════════════════════════════════════════
\section{Step 5: Compression Check}

\small
$N_{Ed,comp} = \VAR{NEd_comp}$\,kN
\qquad
$N_{b,Rd} = \VAR{Nb_Rd}$\,kN

\medskip
$N_{Ed}/N_{b,Rd} = \VAR{compression_util}$\;
\BLOCK{if compression_ok}\pass\BLOCK{else}\fail\BLOCK{endif}

\vspace{4mm}

% ══════════════════════════════════════════════════════════════
%  Tension Check (full width)
% ══════════════════════════════════════════════════════════════
\section{Steps 6--7: Tension Check}
{\footnotesize\itshape \S\,6.2.3}

\small
\BLOCK{if has_holes}%
$N_{t,Rd} = \min(N_{pl,Rd},\; 0.9 A_{net} f_u / \gamma_{M2})$
\BLOCK{else}%
No holes $\Rightarrow N_{t,Rd} = N_{pl,Rd} = A \cdot f_y / \gamma_{M0}$
\BLOCK{endif}

$N_{t,Rd} = \VAR{Nt_Rd}$\,kN

\medskip
$N_{Ed,tens} = \VAR{NEd_tens}$\,kN

$N_{Ed}/N_{t,Rd} = \VAR{tension_util}$\;
\BLOCK{if tension_ok}\pass\BLOCK{else}\fail\BLOCK{endif}

\vspace{4mm}

% ══════════════════════════════════════════════════════════════
%  Summary
% ══════════════════════════════════════════════════════════════
\section{Design Summary}
\vspace{2mm}

\begin{center}
\footnotesize
\begin{tabular}{@{}lrrrl@{}}
\toprule
\textbf{Check} & \textbf{Capacity} & \textbf{Demand} & \textbf{Util.} & \\
\midrule
Compression (\S\,6.3.1)  & $N_{b,Rd} = \VAR{Nb_Rd}$\,kN & $N_{Ed} = \VAR{NEd_comp}$\,kN & \VAR{compression_util} & \BLOCK{if compression_ok}\pass\BLOCK{else}\fail\BLOCK{endif} \\
Tension (\S\,6.2.3)      & $N_{t,Rd} = \VAR{Nt_Rd}$\,kN & $N_{Ed} = \VAR{NEd_tens}$\,kN & \VAR{tension_util} & \BLOCK{if tension_ok}\pass\BLOCK{else}\fail\BLOCK{endif} \\
\midrule
\multicolumn{4}{@{}l}{\textbf{OVERALL}} & \BLOCK{if overall_ok}\pass\BLOCK{else}\fail\BLOCK{endif} \\
\bottomrule
\end{tabular}
\end{center}

\end{document}
